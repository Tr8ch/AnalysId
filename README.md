# Отчет работы и результата сервиса idocs.kz

> 
> Результатом анализа является ответ на вопрос:
> - Как интегрировать подписи системы, так чтобы они могли проверяться на check.doodocs.kz?
> 
#### Какой тип подписи? - XML, CMS, etc.
> - `.xml` файл, каждого подписанта
#### Как выглядит подписанный документ, который подтверждает факт успешного подписания?
> - Это `.zip` архив, который содержит в себе папку (с наванием подписываемого документа и номером документа, котрый вы указываете на сайте). Непосредственно в этой папке находятся 3 файла:
> 	- Оригинал документа
>	- Паспорт документа (`.pdf` документ, содержащий в себе информацию о подписантах и изменениях в отправке документа)
>	-  Подписанный документ
> - Еше N (кол-во подписантов) директорий (папок) в каждой из которых лежит подпись подписанта в формате `.xml`
![Содержание](https://github.com/Tr8ch/AnalysId/blob/main/img/Soderzhanie.png)

#### Что конкретно подписывается? - Хеш, бинарные данные, UUID документ и т.д.
> - Хэш вашего документа 
#### Как проверяется на сервисе?
> - Непосредственно сервиса проверки подписанного документа на легитимность нет. Но на странице с документом может быть флаг "Подписан/Ожидает подписания/Отправлен/Черновик" что и являеся их проверкой.
![Подписан](https://github.com/Tr8ch/AnalysId/blob/main/img/)Podpisan.png)
![Ожидает подписания](https://github.com/Tr8ch/AnalysId/blob/main/img/)Ozhidaet.png)
![Отправлен](https://github.com/Tr8ch/AnalysId/blob/main/img/)Otpravlen.png)
![Черновик](https://github.com/Tr8ch/AnalysId/blob/main/img/)Chernovik.png)

#### Как можно проверить подпись вне этого сервиса?
> - Проверить легитимность подписи можно на сайте https://ezsigner.kz/#!/checkCMS, отправив `.xml` подпись каждого подписанта отдельно. 

## HTTP-запросы

> \*Данный текст не является частью анализа и нужно удалить при сдаче.
> 
> В этом разделе нужно описать последовательность HTTP запросов, которые приводят к подписанию документа.
> Каждый запрос должен иметь пример HTTP-запроса командой `curl` и HTTP-ответ.
> Каждый запрос должен быть описан, где объясняется что происходит и зачем нужен этот запрос.
> 
> Ниже представлены примеры.


### №1. Загрузка документа

- Данный ниже `curl` запрос может отправить документ и создать его в разделе "Внешние/Черновики", в ответ вы получите json response о успешном создании документа.
- Так же вы можете заметить в комментариях флаг `{omitempty}` если убрать поля под ним и отправить запрос без них, то в ответ так же придет json response о успешном создании документа, но в разделе "Внешние/Черновики" документ не появится:)
- При отправке запроса не забудьте заменить "`...`" на значения подходящего типа.
- Указать полный путь вместо `<filepath>`.
- А также если установить значения в поле `Category=0`, то в ответ так же придет json response о успешном создании документа, но в разделе "Внешние/Черновики" документ не появится:) 
- Если установить `CreationType` в значении `2`, то документ можно будет просмотреть и при его скачивании никаких проблем не возникает, а вот в остальных значенияx `1/3/4` документ нельзя просмотреть и при скачивании выдает ошибку или скачивает пустой архив.
- `DocumentGroupId` есть 10 значений для каждого вида докумена:

 Юридические  
 - a3fa4c08-34fa-428d-afc5-7073c9fcab69
   
 Бухгалтерские
 - 4484d2e5-ec9c-4715-8ac9-46dc90e32594

 Складские
 - ab79b353-820b-4afd-87dd-4e8e10f633bf

 Кадровые
 - eb1d1a24-5d62-4db5-9586-2591d2d195b7

 Служебные
 - 50e5f2fb-b93a-476d-9ac9-84c5fa29d584

 Финансовые 
 - d5bbceda-3276-483a-8688-da77d8427b28

 Учредительные
 - ffd87147-84f4-41a9-ad39-fba1cf200e9c

 Организационно-правовые
 - 8cf4366c-ece9-41e5-862d-cfbcd4ae60d8

 Закупки
 - c2d3f988-c359-42f7-bc7f-b2b459b1bc27
 
 Прочие
 - 0cea3b9b-ac5e-407e-a79e-6292df9d4981


#### `POST` Запрос:
```sh
curl --location 'https://api.idocs.kz/api/v2/reference/fact-documents/iDocsApi.create-with-file' \
--header 'Authorization: Bearer Token ...' \
# Number string {omitempty}
--form 'Number="..."' \
# Name string
--form 'Name="..."' \
# {omitempty}
--form 'Date="YYYY-MM-DDTHH:MM:SS.sssZ"' \
# CreationType int32 от 0 до 4 {omitempty}
--form 'CreationType="..."' \ 
# {omitempty}
--form 'File=@"<filepath>"' \
# Category int32 есть два значения (0 и 1)
--form 'Category="..."' \
# DocumentGroupId uuid
--form 'DocumentGroupId="..."'
```

Ответ:

```json
{
    "@odata.context": "https://api.idocs.kz/api/v2/reference/$metadata#iDocsApi.ApiSuccessResponseModel_1OfGuid",
    "Header": "Успешно",
    "Description": "Документ с номером ... успешно создан",
    "Payload": "e56a18df-1c27-4df3-314b-08dbe238765a"
}
```

### №2. Отправка подписи

Данный запрос отправляет подпись и привязывает его к документу. В ответ не передается никакой информации - только статус 200.

Запрос:
```sh
curl -X POST \
	-H "Content-Type: multipart/form-data" \
	-H "Authorization: Bearer token..." \
	-d "..." \ # Передаваемые данные
	https://api.system.kz/api/v1/prepare/documents/3fec9ab2-3b88-4bf7-ada3-2f427643ba1c/sign
```

Ответ:

```http
200 OK
```

## Описание подписанного документа

> \*Данный текст не является частью анализа и нужно удалить при сдаче.
> 
> В этом разделе нужно описать результирующий подписанный файл. Целью данного раздела является разведка всей полезной информации выдаваемой в результирующем файле.
> 
> - Если это архив, то описать каждый файл с указанием названия и объяснением что содержится в этом файле.
> - Если это PDF, то описать каждую секцию с указанием названия секции и что в себе содержит.
> - Если в документах содержатся QR'ы, то отсканировать каждый и понять как его использовать при верификации подписи. Данный момент отразить в описании.
> - Если в документах содержатся URL ссылки, то зайти по ссылке, понять что она отображает и чем может быть полезна. Данный момент отразить в описании.
> 
> То же самое касается любой потенциально полезной информации.
>  
>  Можно прилагать скрины.

## Описание подписей

> \*Данный текст не является частью анализа и нужно удалить при сдаче.
> 
> В этом разделе нужно проанализировать результирующие подписи. Целью этого раздела является анализ содержимого подписей, какая информация хранится в подписи, что конкретно подписывается и любая другая полезная информация.
>
> В данной секции обязательно описать что подписывается ЭЦП ключом - хеш, бинарные данные, UUID документ и т.д. Если это хеш, то как он формируется.
>  
>  В данной секции следует описать команды и инструменты используемые для анализа. Если это bash скрипты то написать команду, вывод и описание.
>   
>  Можно прилагать скрины.

## Описание процесса верификации подписей на сервисе

> \*Данный текст не является частью анализа и нужно удалить при сдаче.
> 
> В этом разделе нужно описать процессы того, как сервис предлагает проверить подпись на легитимность. Перечислить все доступные методы рекомендованные сервисом. Возможно данная информация будет храниться в статьях, блогах или FAQ сервиса.
>  
>  Можно прилагать скрины.

## Описание процесса верификации подписей вне сервиса

> \*Данный текст не является частью анализа и нужно удалить при сдаче.
> 
> В этом разделе нужно описать процессы того, как можно проверить подписи на легитимность вне сервиса, используя технические инструменты - kalkan, openssl и т.д.

---

> \*Данный текст не является частью анализа и нужно удалить при сдаче.
> 
> Если у вас есть дополнительные секции, которые вы хотели бы включить, то оформите ее согласно структуре во всем документе.
